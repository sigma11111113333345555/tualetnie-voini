<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—É–∞–ª–µ—Ç–Ω—ã–µ –≤–æ–π–Ω—ã 4: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            overflow: hidden;
            border: 3px solid #ffcc00;
        }
        
        header {
            background: linear-gradient(90deg, #8B0000, #B22222, #8B0000);
            text-align: center;
            padding: 20px;
            border-bottom: 3px solid #ffcc00;
            position: relative;
        }
        
        .kira-banner {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #ff00cc, #cc00ff);
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            transform: rotate(15deg);
            box-shadow: 0 0 10px rgba(255, 0, 204, 0.7);
        }
        
        h1 {
            font-size: 2.8rem;
            text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.7);
            margin-bottom: 10px;
            color: #ffcc00;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .game-container {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
            gap: 20px;
        }
        
        .status-panel {
            flex: 1;
            min-width: 300px;
            background: rgba(30, 30, 40, 0.8);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #444;
        }
        
        .actions-panel {
            flex: 2;
            min-width: 400px;
            background: rgba(30, 30, 40, 0.8);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #444;
        }
        
        .panel-title {
            background: linear-gradient(90deg, #333, #555, #333);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.4rem;
            color: #ffcc00;
            border-bottom: 2px solid #ffcc00;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        
        .stat-label {
            font-weight: bold;
            color: #ffcc00;
        }
        
        .bar-container {
            height: 25px;
            background: #333;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
            border: 1px solid #555;
        }
        
        .bar {
            height: 100%;
            border-radius: 12px;
            text-align: center;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: width 0.5s;
        }
        
        .anger-bar {
            background: linear-gradient(90deg, #ff6b00, #ff0000);
        }
        
        .health-bar {
            background: linear-gradient(90deg, #00b300, #00ff00);
        }
        
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .action-group {
            margin-bottom: 25px;
        }
        
        .group-title {
            color: #ffcc00;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ffcc00;
        }
        
        button {
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
            border: none;
            border-radius: 5px;
            background: linear-gradient(to bottom, #444, #222);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            position: relative;
            overflow: hidden;
        }
        
        button:hover {
            background: linear-gradient(to bottom, #555, #333);
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.5);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .kira-bonus {
            position: absolute;
            top: 2px;
            right: 5px;
            color: #ff00cc;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 0, 204, 0.7);
        }
        
        .log-container {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            border: 1px solid #444;
            font-family: monospace;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .kira-log {
            background: rgba(204, 0, 255, 0.15);
            border-left: 3px solid #cc00ff;
        }
        
        .victory-screen, .game-over-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .victory-content, .game-over-content {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            text-align: center;
            border: 3px solid gold;
        }
        
        .victory-title {
            font-size: 3rem;
            color: gold;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .modal-btn:hover {
            transform: scale(1.05);
        }
        
        .toilet-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            animation: flush 2s infinite;
        }
        
        .kira-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,0,204,0.2) 0%, rgba(204,0,255,0.1) 70%, rgba(0,0,0,0) 100%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        @keyframes flush {
            0%, 100% { transform: rotate(0deg); color: #fff; }
            25% { transform: rotate(10deg); color: #00ffff; }
            50% { transform: rotate(0deg); color: #fff; }
            75% { transform: rotate(-10deg); color: #00ffff; }
        }
        
        .inventory-item {
            display: inline-block;
            background: rgba(100, 100, 200, 0.3);
            padding: 5px 10px;
            border-radius: 5px;
            margin: 5px 3px;
            border: 1px solid #555;
        }
        
        .kira-item {
            background: rgba(204, 0, 255, 0.3);
            border: 1px solid #cc00ff;
        }
        
        @media (max-width: 768px) {
            .game-container {
                flex-direction: column;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="kira-banner">–ö–ò–†–ê –í –ò–ì–†–ï!</div>
            <h1>üöΩ –¢–£–ê–õ–ï–¢–ù–´–ï –í–û–ô–ù–´ 4 üöΩ</h1>
            <div class="subtitle">–ë–∏—Ç–≤–∞ –ø—Ä–æ—Ç–∏–≤ –ì–µ–æ—Ä–≥–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è! –¢–µ–ø–µ—Ä—å —Å –ö–∏—Ä–æ–π!</div>
        </header>
        
        <div class="game-container">
            <div class="status-panel">
                <div class="panel-title">–°–¢–ê–¢–£–° –ì–ï–û–†–ì–ò–Ø</div>
                
                <div class="stat">
                    <span class="stat-label">üò† –ó–ª–æ—Å—Ç—å:</span>
                    <span id="anger-value">0/100</span>
                </div>
                <div class="bar-container">
                    <div id="anger-bar" class="bar anger-bar" style="width: 0%">0%</div>
                </div>
                
                <div class="stat">
                    <span class="stat-label">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ:</span>
                    <span id="health-value">100/100</span>
                </div>
                <div class="bar-container">
                    <div id="health-bar" class="bar health-bar" style="width: 100%">100%</div>
                </div>
                
                <div class="stat">
                    <span class="stat-label">‚è± –í—Ä–µ–º—è:</span>
                    <span id="time-value">0 —Å–µ–∫</span>
                </div>
                
                <div class="stat">
                    <span class="stat-label">üí∞ –î–µ–Ω—å–≥–∏:</span>
                    <span id="money-value">50 —Ä—É–±</span>
                </div>
                
                <div class="stat">
                    <span class="stat-label">üìõ –î–≤–æ–µ–∫:</span>
                    <span id="dvoek-value">0/4</span>
                </div>
                
                <div class="stat">
                    <span class="stat-label">üõ°Ô∏è –ó–∞—â–∏—Ç—ã:</span>
                    <span id="defended-value">0/3</span>
                </div>
                
                <div class="stat">
                    <span class="stat-label">üìç –õ–æ–∫–∞—Ü–∏—è:</span>
                    <span id="location-value">—Ç—É–∞–ª–µ—Ç</span>
                </div>
                
                <div class="stat">
                    <span class="stat-label">üìä –†–µ–ø—É—Ç–∞—Ü–∏—è:</span>
                    <span id="reputation-value">0</span>
                </div>
                
                <div class="stat">
                    <span class="stat-label">‚ú® –ö–∏—Ä–∞:</span>
                    <span id="kira-status">–Ω–µ –∞–∫—Ç–∏–≤–Ω–∞</span>
                </div>
                
                <div class="panel-title" style="margin-top: 20px;">üéí –ò–ù–í–ï–ù–¢–ê–†–¨</div>
                <div id="inventory-container"></div>
            </div>
            
            <div class="actions-panel">
                <div class="kira-effect" id="kira-effect"></div>
                <div class="panel-title">–î–ï–ô–°–¢–í–ò–Ø</div>
                
                <div class="action-group">
                    <div class="group-title">üéÆ –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
                    <div class="actions-grid">
                        <button id="action-tease">1. –î—Ä–∞–∑–Ω–∏—Ç—å –ì–µ–æ—Ä–≥–∏—è (+–∑–ª–æ—Å—Ç—å, +–¥–µ–Ω—å–≥–∏)<span class="kira-bonus">x2</span></button>
                        <button id="action-light">2. –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç (100% —É—Ä–æ–Ω 10-100 HP)</button>
                        <button id="action-paper">3. –£–∫—Ä–∞—Å—Ç—å –±—É–º–∞–≥—É (-15-25 HP)</button>
                        <button id="action-break">4. –°–ª–æ–º–∞—Ç—å –±–∞—á–æ–∫ (-20-40 HP)</button>
                        <button id="action-photo">5. –°—Ñ–æ—Ç–∫–∞—Ç—å '—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã' (—É—Ä–æ–Ω –∫–∞–∂–¥–æ–µ 2-–µ —Ñ–æ—Ç–æ)<span class="kira-bonus">x2</span></button>
                    </div>
                </div>
                
                <div class="action-group">
                    <div class="group-title">üì¶ –î–æ–ø. –¥–µ–π—Å—Ç–≤–∏—è</div>
                    <div class="actions-grid">
                        <button id="action-timofey">6. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¢–∏–º–æ—Ñ–µ—è (-30 –∑–ª–æ—Å—Ç–∏)</button>
                        <button id="action-bribe">7. –ü–æ–¥–∫—É–ø–∏—Ç—å –Æ–ª—é (50 —Ä—É–±, –±–ª–æ–∫ –¥–≤–æ–π–∫–∏)</button>
                        <button id="action-buy">8. –ö—É–ø–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç (–±–∞–ª–ª–æ–Ω—á–∏–∫/–∫–Ω–æ–ø–∫–∞/–º—ã–ª–æ)</button>
                        <button id="action-use">9. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç</button>
                        <button id="action-move">10. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥—Ä—É–≥—É—é –ª–æ–∫–∞—Ü–∏—é</button>
                        <button id="action-kira">11. –í—ã–∑–≤–∞—Ç—å –ö–∏—Ä—É (70 —Ä—É–±)<span class="kira-bonus">NEW!</span></button>
                    </div>
                </div>
                
                <div class="action-group">
                    <div class="group-title">‚öôÔ∏è –°–∏—Å—Ç–µ–º–∞</div>
                    <div class="actions-grid">
                        <button id="action-save">12. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É</button>
                        <button id="action-menu">13. –í—ã–π—Ç–∏ –≤ –º–µ–Ω—é</button>
                    </div>
                </div>
                
                <div class="panel-title" style="margin-top: 20px;">üìú –ñ–£–†–ù–ê–õ –°–û–ë–´–¢–ò–ô</div>
                <div id="log" class="log-container"></div>
            </div>
        </div>
    </div>
    
    <div id="victory-screen" class="victory-screen" style="display: none;">
        <div class="victory-content">
            <div class="toilet-icon">üöΩ</div>
            <h2 class="victory-title">üéâ –ü–û–ë–ï–î–ê! üéâ</h2>
            <p>–¢–´ –í–´–°–¢–û–Ø–õ –ü–†–û–¢–ò–í –ì–ï–û–†–ì–ò–Ø!</p>
            
            <div class="stats-grid">
                <div class="stat-box">
                    <div>‚è± –í—Ä–µ–º—è:</div>
                    <div id="victory-time">0 —Å–µ–∫</div>
                </div>
                <div class="stat-box">
                    <div>üí∞ –î–µ–Ω—å–≥–∏:</div>
                    <div id="victory-money">0 —Ä—É–±</div>
                </div>
                <div class="stat-box">
                    <div>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ –ì–µ–æ—Ä–≥–∏—è:</div>
                    <div id="victory-health">0/100</div>
                </div>
                <div class="stat-box">
                    <div>üõ°Ô∏è –ó–∞—â–∏—Ç—ã:</div>
                    <div id="victory-defended">0/3</div>
                </div>
                <div class="stat-box">
                    <div>‚ú® –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –ö–∏—Ä—ã:</div>
                    <div id="victory-kira">0 —Ä–∞–∑</div>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button id="victory-save" class="modal-btn" style="background: linear-gradient(to bottom, #4CAF50, #2E7D32);">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤—ã–π—Ç–∏ –≤ –º–µ–Ω—é</button>
                <button id="victory-continue" class="modal-btn" style="background: linear-gradient(to bottom, #2196F3, #0D47A1);">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É (–ø–µ—Å–æ—á–Ω–∏—Ü–∞)</button>
            </div>
        </div>
    </div>
    
    <div id="math-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: #222; padding: 30px; border-radius: 10px; text-align: center; width: 90%; max-width: 500px; border: 2px solid #ffcc00;">
            <h2 style="color: #ffcc00; margin-bottom: 20px;">üßÆ –†–ï–®–ò –ü–†–ò–ú–ï–†!</h2>
            <p id="math-problem" style="font-size: 1.8rem; margin: 20px 0;">10 + 15 = ?</p>
            <input type="number" id="math-answer" style="padding: 12px; font-size: 1.5rem; width: 80%; margin: 10px auto; display: block; text-align: center; background: #333; color: white; border: 1px solid #555; border-radius: 5px;">
            <button id="math-submit" style="padding: 12px 30px; font-size: 1.2rem; background: linear-gradient(to bottom, #4CAF50, #2E7D32); color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 20px;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        </div>
    </div>
    
    <div id="buy-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: #222; padding: 30px; border-radius: 10px; text-align: center; width: 90%; max-width: 500px; border: 2px solid #ffcc00;">
            <h2 style="color: #ffcc00; margin-bottom: 20px;">üõí –ú–ê–ì–ê–ó–ò–ù</h2>
            <div style="margin: 20px 0;">
                <button class="buy-item" data-item="–ë–∞–ª–ª–æ–Ω—á–∏–∫" data-price="40" style="display: block; width: 100%; margin: 10px 0; padding: 15px; background: #333; color: white; border: 1px solid #555; border-radius: 5px; cursor: pointer;">
                    –ë–∞–ª–ª–æ–Ω—á–∏–∫ (40 —Ä—É–±) - —Ö–∏–º–∏—á–µ—Å–∫–∞—è –∞—Ç–∞–∫–∞
                </button>
                <button class="buy-item" data-item="–ö–Ω–æ–ø–∫–∞" data-price="100" style="display: block; width: 100%; margin: 10px 0; padding: 15px; background: #333; color: white; border: 1px solid #555; border-radius: 5px; cursor: pointer;">
                    –ö–Ω–æ–ø–∫–∞ (100 —Ä—É–±) - —Ç—Ä–µ–≤–æ–∂–Ω–∞—è –∫–Ω–æ–ø–∫–∞
                </button>
                <button class="buy-item" data-item="–ú—ã–ª–æ" data-price="10" style="display: block; width: 100%; margin: 10px 0; padding: 15px; background: #333; color: white; border: 1px solid #555; border-radius: 5px; cursor: pointer;">
                    –ú—ã–ª–æ (10 —Ä—É–±) - –ø–æ—Å–∫–æ–ª—å–∑–Ω—É—Ç—å—Å—è (-25 HP)
                </button>
            </div>
            <button id="buy-cancel" style="padding: 12px 30px; font-size: 1.2rem; background: linear-gradient(to bottom, #f44336, #b71c1c); color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
    
    <div id="use-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: #222; padding: 30px; border-radius: 10px; text-align: center; width: 90%; max-width: 500px; border: 2px solid #ffcc00;">
            <h2 style="color: #ffcc00; margin-bottom: 20px;">üéí –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –ü–†–ï–î–ú–ï–¢</h2>
            <div id="use-items-container" style="margin: 20px 0;"></div>
            <button id="use-cancel" style="padding: 12px 30px; font-size: 1.2rem; background: linear-gradient(to bottom, #f44336, #b71c1c); color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
    
    <div id="move-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: #222; padding: 30px; border-radius: 10px; text-align: center; width: 90%; max-width: 500px; border: 2px solid #ffcc00;">
            <h2 style="color: #ffcc00; margin-bottom: 20px;">üö™ –ü–ï–†–ï–ô–¢–ò –í –õ–û–ö–ê–¶–ò–Æ</h2>
            <div style="margin: 20px 0;">
                <button class="move-location" data-location="—Ç—É–∞–ª–µ—Ç" style="display: block; width: 100%; margin: 10px 0; padding: 15px; background: #333; color: white; border: 1px solid #555; border-radius: 5px; cursor: pointer;">
                    –¢—É–∞–ª–µ—Ç
                </button>
                <button class="move-location" data-location="–∫–æ—Ä–∏–¥–æ—Ä" style="display: block; width: 100%; margin: 10px 0; padding: 15px; background: #333; color: white; border: 1px solid #555; border-radius: 5px; cursor: pointer;">
                    –ö–æ—Ä–∏–¥–æ—Ä
                </button>
                <button class="move-location" data-location="–∫–ª–∞—Å—Å" style="display: block; width: 100%; margin: 10px 0; padding: 15px; background: #333; color: white; border: 1px solid #555; border-radius: 5px; cursor: pointer;">
                    –ö–ª–∞—Å—Å
                </button>
            </div>
            <button id="move-cancel" style="padding: 12px 30px; font-size: 1.2rem; background: linear-gradient(to bottom, #f44336, #b71c1c); color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        class Game {
            constructor() {
                // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                this.anger = 0;
                this.health = 100;
                this.dvoek = 0;
                this.money = 50;
                this.difficulty = "easy";
                this.game_over = false;
                this.punished = false;
                this.start_time = 0;
                this.victory_achieved = false;
                this.last_update_time = 0;
                
                // –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                this.location = "—Ç—É–∞–ª–µ—Ç";
                this.reputation = 0;
                this.inventory = [];
                this.inventory_size = 3;
                this.found_diary = false;
                this.used_panic = false;
                
                // –°–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
                this.timofey_available = true;
                this.timofey_used = false;
                this.bribed = false;
                this.god_mode = false;
                
                // –ö–∏—Ä–∞
                this.kira_active = false;
                this.kira_time = 0;
                this.kira_duration = 30; // 30 —Å–µ–∫—É–Ω–¥
                this.kira_used_count = 0;
                
                // –°–æ—Å—Ç–æ—è–Ω–∏—è
                this.light_on = true;
                this.toilet_paper_taken = false;
                this.broken_toilet = false;
                this.photo_count = 0;
                this.complaints = 0;
                this.defended = 0;
            }

            reset() {
                this.constructor();
                if (this.difficulty === "hard") {
                    this.timofey_available = false;
                } else if (this.difficulty === "hardcore") {
                    this.timofey_available = false;
                }
            }

            increase_anger(amount) {
                if (this.god_mode) {
                    this.addToLog("üåÄ –†–µ–∂–∏–º –±–æ–≥–∞: –ì–µ–æ—Ä–≥–∏–π –Ω–µ –∑–ª–∏—Ç—Å—è!");
                    return;
                }
                
                // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞ –ö–∏—Ä–∞, –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–ª–æ—Å—Ç—å
                if (this.kira_active) {
                    this.addToLog("‚ú® –ö–∏—Ä–∞ –∑–∞—â–∏—â–∞–µ—Ç: –∑–ª–æ—Å—Ç—å –Ω–µ —Ä–∞—Å—Ç–µ—Ç!", true);
                    return;
                }
                    
                this.anger = Math.min(100, this.anger + amount);
                
                if (this.anger >= 100) {
                    this.handle_complaint();
                }
            }

            activateKira() {
                if (this.kira_active) {
                    this.addToLog("‚ú® –ö–∏—Ä–∞ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞!");
                    return;
                }
                
                if (this.money < 70) {
                    this.addToLog("üí∏ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ –¥–ª—è –≤—ã–∑–æ–≤–∞ –ö–∏—Ä—ã! –ù—É–∂–Ω–æ 70 —Ä—É–±–ª–µ–π.");
                    return;
                }
                
                this.money -= 70;
                this.kira_active = true;
                this.kira_time = Date.now();
                this.kira_used_count++;
                this.addToLog("‚ú®‚ú®‚ú® –ö–ò–†–ê –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ê! –¢–µ–ø–µ—Ä—å –∑–ª–æ—Å—Ç—å –Ω–µ —Ä–∞—Å—Ç–µ—Ç, –∞ –¥–æ—Ö–æ–¥ —É–¥–≤–∞–∏–≤–∞–µ—Ç—Å—è! ‚ú®‚ú®‚ú®", true);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç –ö–∏—Ä—ã
                document.getElementById('kira-effect').style.opacity = '1';
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –Ω–∞ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—é
                setTimeout(() => {
                    if (this.kira_active) {
                        this.kira_active = false;
                        this.addToLog("‚è± –í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è –ö–∏—Ä—ã –∏—Å—Ç–µ–∫–ª–æ.", true);
                        document.getElementById('kira-effect').style.opacity = '0';
                    }
                }, this.kira_duration * 1000);
            }

            handle_complaint() {
                this.anger = 100;
                this.complaints++;
                this.addToLog("\nüî• –ì–µ–æ—Ä–≥–∏–π –≤ —è—Ä–æ—Å—Ç–∏! –û–Ω –∂–∞–ª—É–µ—Ç—Å—è –Æ–ª–µ –°–µ—Ä–≥–µ–µ–≤–Ω–µ! üî•");
                
                const difficulty_boost = this.reputation * 5;
                this.showMathProblem(difficulty_boost);
            }

            showMathProblem(difficulty_boost) {
                let a, b;
                
                if (this.difficulty === "easy") {
                    a = Math.floor(Math.random() * 99) + 2;
                    b = Math.floor(Math.random() * 99) + 2;
                } else if (this.difficulty === "normal") {
                    a = Math.floor(Math.random() * 901) + 100;
                    b = Math.floor(Math.random() * 901) + 100;
                } else if (this.difficulty === "hard") {
                    a = Math.floor(Math.random() * 4001) + 1000;
                    b = Math.floor(Math.random() * 4001) + 1000;
                } else {
                    a = Math.floor(Math.random() * 90001) + 10000;
                    b = Math.floor(Math.random() * 90001) + 10000;
                }
                
                a += difficulty_boost;
                b += difficulty_boost;
                
                this.correct_answer = a + b;
                document.getElementById('math-problem').textContent = `${a} + ${b} = ?`;
                document.getElementById('math-answer').value = '';
                document.getElementById('math-modal').style.display = 'flex';
            }

            solve_math_problem(answer) {
                if (parseInt(answer) === this.correct_answer) {
                    this.addToLog("‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –î–≤–æ–π–∫–∏ –Ω–µ –±—É–¥–µ—Ç!");
                    this.defended++;
                    if (this.defended >= 3) {
                        this.victory();
                    }
                    return true;
                }
                
                this.addToLog(`‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –û—Ç–≤–µ—Ç: ${this.correct_answer}`);
                if (!this.bribed && !this.timofey_used) {
                    this.dvoek++;
                    this.addToLog(`üìõ –Æ–ª—è –°–µ—Ä–≥–µ–µ–≤–Ω–∞ –ø–æ—Å—Ç–∞–≤–∏–ª–∞ –¥–≤–æ–π–∫—É! –í—Å–µ–≥–æ –¥–≤–æ–µ–∫: ${this.dvoek}/4`);
                    this.check_punishment();
                }
                return false;
            }

            apply_damage(min_dmg, max_dmg) {
                const damage = Math.floor(Math.random() * (max_dmg - min_dmg + 1)) + min_dmg;
                this.health = Math.max(0, this.health - damage);
                this.addToLog(`üí• –ì–µ–æ—Ä–≥–∏–π –ø–æ–ª—É—á–∏–ª —É—Ä–æ–Ω: -${damage} HP`);
                if (this.health <= 0) {
                    this.health = 0;
                    if (!this.victory_achieved) {
                        this.addToLog("\nüíÄ –ì–µ–æ—Ä–≥–∏–π —Å–ª–æ–º–ª–µ–Ω! –ù–æ –ø–æ–±–µ–¥–∞ –Ω–µ –∑–∞—Å—á–∏—Ç–∞–Ω–∞ ‚Äî –Ω—É–∂–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è 3 —Ä–∞–∑–∞.");
                    } else {
                        this.addToLog("\nüíÄ –ì–µ–æ—Ä–≥–∏–π –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –ø–æ–≤–µ—Ä–∂–µ–Ω!");
                    }
                }
            }

            toggle_light() {
                this.light_on = !this.light_on;
                if (!this.light_on) {
                    this.addToLog("\nüí° –ì–µ–æ—Ä–≥–∏–π –æ—Ä–µ—Ç –≤ —Ç–µ–º–Ω–æ—Ç–µ! +15 –∑–ª–æ—Å—Ç–∏");
                    this.increase_anger(15);
                    const damage = Math.floor(Math.random() * 91) + 10;
                    this.addToLog(`üí• –ì–µ–æ—Ä–≥–∏–π —É–ø–∞–ª –≤ —Ç–µ–º–Ω–æ—Ç–µ! -${damage} HP`);
                    this.apply_damage(damage, damage);
                } else {
                    this.addToLog("\nüí° –°–≤–µ—Ç –≤–∫–ª—é—á–µ–Ω. –ì–µ–æ—Ä–≥–∏–π —É—Å–ø–æ–∫–æ–∏–ª—Å—è (-5 –∑–ª–æ—Å—Ç–∏).");
                    this.anger = Math.max(0, this.anger - 5);
                }
            }

            steal_toilet_paper() {
                if (!this.toilet_paper_taken) {
                    this.toilet_paper_taken = true;
                    this.addToLog("\nüßª –ì–µ–æ—Ä–≥–∏–π –ø–ª–∞—á–µ—Ç –∏ –ø–æ–¥—Ç–∏—Ä–∞–µ—Ç—Å—è –ø–∞–ª—å—Ü–µ–º! üò≠ +20 –∑–ª–æ—Å—Ç–∏");
                    this.apply_damage(15, 25);
                    this.increase_anger(20);
                } else {
                    this.addToLog("\nüö´ –ë—É–º–∞–≥–∞ —É–∂–µ —É–∫—Ä–∞–¥–µ–Ω–∞!");
                }
            }

            use_chemical_attack() {
                if (this.inventory.includes("–ë–∞–ª–ª–æ–Ω—á–∏–∫")) {
                    this.addToLog("\nüí® –•–ò–ú–ò–ß–ï–°–ö–ê–Ø –ê–¢–ê–ö–ê! –ì–µ–æ—Ä–≥–∏–π –±–µ–∂–∏—Ç –∏–∑ —Ç—É–∞–ª–µ—Ç–∞!");
                    this.addToLog("–ó–ª–æ—Å—Ç—å = 0, –Ω–æ –∑–¥–æ—Ä–æ–≤—å–µ -50");
                    this.anger = 0;
                    this.apply_damage(50, 50);
                    this.inventory = this.inventory.filter(item => item !== "–ë–∞–ª–ª–æ–Ω—á–∏–∫");
                } else {
                    this.addToLog("\nüö´ –£ –≤–∞—Å –Ω–µ—Ç –±–∞–ª–ª–æ–Ω—á–∏–∫–∞!");
                }
            }

            break_toilet() {
                if (!this.broken_toilet) {
                    this.broken_toilet = true;
                    this.addToLog("\nüöΩ –ë–∞—á–æ–∫ —Å–ª–æ–º–∞–Ω! –ì–µ–æ—Ä–≥–∏–π –Ω–µ –º–æ–∂–µ—Ç —Å–º—ã—Ç—å! üí© +30 –∑–ª–æ—Å—Ç–∏");
                    this.apply_damage(20, 40);
                    this.increase_anger(30);
                } else {
                    this.addToLog("\nüö´ –ë–∞—á–æ–∫ —É–∂–µ —Å–ª–æ–º–∞–Ω!");
                }
            }

            take_photo() {
                if (this.broken_toilet) {
                    this.photo_count++;
                    const anger_gain = 10 * this.photo_count;
                    this.increase_anger(anger_gain);
                    
                    // –£–¥–≤–∞–∏–≤–∞–µ–º –¥–µ–Ω—å–≥–∏, –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞ –ö–∏—Ä–∞
                    const money_gain = 15 * (this.kira_active ? 2 : 1);
                    this.money += money_gain;
                    
                    this.addToLog(`\nüì∏ –§–æ—Ç–æ #${this.photo_count} —Å–¥–µ–ª–∞–Ω–æ! +${anger_gain} –∑–ª–æ—Å—Ç–∏, +${money_gain} —Ä—É–±`);
                    if (this.photo_count % 2 === 0) {
                        this.apply_damage(5, 15);
                    }
                } else {
                    this.addToLog("\nüö´ –°–Ω–∞—á–∞–ª–∞ —Å–ª–æ–º–∞–π –±–∞—á–æ–∫!");
                }
            }

            check_punishment() {
                if (this.dvoek >= 4 && !this.punished) {
                    this.punished = true;
                    this.money = 0;
                    this.addToLog("\nüî•üî•üî• –ú–ê–ú–ê –£–ó–ù–ê–õ–ê –û –î–í–û–ô–ö–ê–•! üî•üî•üî•");
                    this.addToLog("üíª –ö–æ–º–ø—å—é—Ç–µ—Ä –∑–∞–±—Ä–∞–ª–∏ –Ω–∞ –¥–µ–Ω—å!");
                    this.addToLog("üí∏ –í—Å–µ –¥–µ–Ω—å–≥–∏ –∫–æ–Ω—Ñ–∏—Å–∫–æ–≤–∞–Ω—ã!");
                    this.game_over = true;
                }
            }

            buy_item(item) {
                const prices = {"–ë–∞–ª–ª–æ–Ω—á–∏–∫": 40, "–ö–Ω–æ–ø–∫–∞": 100, "–ú—ã–ª–æ": 10};
                if (item in prices) {
                    if (this.money >= prices[item]) {
                        if (this.inventory.length < this.inventory_size) {
                            this.money -= prices[item];
                            this.inventory.push(item);
                            this.addToLog(`\nüõí –ö—É–ø–ª–µ–Ω–æ: ${item}!`);
                        } else {
                            this.addToLog("\nüéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω!");
                        }
                    } else {
                        this.addToLog("\nüí∏ –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥!");
                    }
                } else {
                    this.addToLog("\nüö´ –¢–∞–∫–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç!");
                }
            }

            use_timofey() {
                if (this.timofey_available && !this.timofey_used) {
                    if (this.difficulty === "normal" && this.money < 30) {
                        this.addToLog("\nüí∏ –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥ –¥–ª—è –ø–æ–¥–∫—É–ø–∞ –¢–∏–º–æ—Ñ–µ—è!");
                        return;
                    }
                    
                    if (this.difficulty === "normal") {
                        this.money -= 30;
                    }
                    
                    this.addToLog("\nü¶∏ –¢–∏–º–æ—Ñ–µ–π –∑–∞—â–∏—â–∞–µ—Ç –≤–∞—Å! -30 –∑–ª–æ—Å—Ç–∏");
                    this.anger = Math.max(0, this.anger - 30);
                    this.timofey_used = true;
                    
                    if (this.difficulty !== "easy") {
                        this.timofey_available = false;
                    }
                } else if (!this.timofey_available) {
                    this.addToLog("\nüö´ –¢–∏–º–æ—Ñ–µ–π –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!");
                } else {
                    this.addToLog("\nüö´ –¢–∏–º–æ—Ñ–µ–π —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!");
                }
            }

            bribe() {
                if (!this.bribed) {
                    if (this.money >= 50) {
                        this.money -= 50;
                        this.bribed = true;
                        this.addToLog("\nüí∞ –Æ–ª—è –°–µ—Ä–≥–µ–µ–≤–Ω–∞ –ø–æ–¥–∫—É–ø–ª–µ–Ω–∞! –°–ª–µ–¥—É—é—â–∞—è –∂–∞–ª–æ–±–∞ –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∞.");
                    } else {
                        this.addToLog("\nüí∏ –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥!");
                    }
                } else {
                    this.addToLog("\nüö´ –Æ–ª—è –°–µ—Ä–≥–µ–µ–≤–Ω–∞ —É–∂–µ –ø–æ–¥–∫—É–ø–ª–µ–Ω–∞!");
                }
            }

            use_panic_button() {
                if (!this.used_panic) {
                    // –£–¥–≤–∞–∏–≤–∞–µ–º –¥–µ–Ω—å–≥–∏, –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞ –ö–∏—Ä–∞
                    const money_gain = 50 * (this.kira_active ? 2 : 1);
                    this.money += money_gain;
                    
                    this.addToLog("\nüö® –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ê –¢–†–ï–í–û–ñ–ù–ê–Ø –ö–ù–û–ü–ö–ê!");
                    this.addToLog(`–í—Å–µ –≤—ã–±–µ–≥–∞—é—Ç –∏–∑ —à–∫–æ–ª—ã! +${money_gain} —Ä—É–±`);
                    this.used_panic = true;
                    this.anger = Math.max(0, this.anger - 40);
                } else {
                    this.addToLog("\nüö´ –ö–Ω–æ–ø–∫–∞ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞!");
                }
            }

            change_location(new_location) {
                const locations = ["—Ç—É–∞–ª–µ—Ç", "–∫–æ—Ä–∏–¥–æ—Ä", "–∫–ª–∞—Å—Å"];
                if (locations.includes(new_location)) {
                    this.location = new_location;
                    this.addToLog(`\nüö™ –í—ã –ø–µ—Ä–µ—à–ª–∏ –≤ –ª–æ–∫–∞—Ü–∏—é: ${this.location.toUpperCase()}`);
                    if (this.location === "–∫–æ—Ä–∏–¥–æ—Ä" && Math.random() < 0.2) {
                        this.addToLog("üëÆ –î–∏—Ä–µ–∫—Ç–æ—Ä –∏–¥—ë—Ç –ø–æ –∫–æ—Ä–∏–¥–æ—Ä—É! –ü—Ä–∏–¥—ë—Ç—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è.");
                        this.location = "—Ç—É–∞–ª–µ—Ç";
                    }
                    
                    if (this.location === "–∫–ª–∞—Å—Å") {
                        this.steal_diary();
                    }
                } else {
                    this.addToLog("\nüö´ –ù–µ–ª—å–∑—è –ø–µ—Ä–µ–π—Ç–∏ –≤ —ç—Ç—É –ª–æ–∫–∞—Ü–∏—é!");
                }
            }

            steal_diary() {
                if (this.location === "–∫–ª–∞—Å—Å" && !this.found_diary) {
                    if (Math.random() < 0.3) {
                        this.found_diary = true;
                        this.addToLog("\nüìî –í—ã –Ω–∞—à–ª–∏ –¥–Ω–µ–≤–Ω–∏–∫ –ì–µ–æ—Ä–≥–∏—è! –¢–µ–ø–µ—Ä—å –∑–ª–æ—Å—Ç—å —Ä–∞—Å—Ç—ë—Ç –±—ã—Å—Ç—Ä–µ–µ.");
                        this.reputation += 2;
                    } else {
                        this.addToLog("\nüîç –í—ã –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à–ª–∏...");
                    }
                }
            }

            victory() {
                const elapsed_time = Math.floor((Date.now() - this.start_time) / 1000);
                this.victory_achieved = true;
                
                document.getElementById('victory-time').textContent = `${elapsed_time} —Å–µ–∫`;
                document.getElementById('victory-money').textContent = `${this.money} —Ä—É–±`;
                document.getElementById('victory-health').textContent = `${this.health}/100`;
                document.getElementById('victory-defended').textContent = `${this.defended}/3`;
                document.getElementById('victory-kira').textContent = `${this.kira_used_count} —Ä–∞–∑`;
                
                document.getElementById('victory-screen').style.display = 'flex';
            }

            addToLog(message, isKira = false) {
                const log = document.getElementById('log');
                const entry = document.createElement('div');
                entry.className = `log-entry ${isKira ? 'kira-log' : ''}`;
                entry.textContent = message;
                log.appendChild(entry);
                log.scrollTop = log.scrollHeight;
            }

            updateUI() {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
                document.getElementById('anger-value').textContent = `${this.anger}/100`;
                document.getElementById('health-value').textContent = `${this.health}/100`;
                document.getElementById('dvoek-value').textContent = `${this.dvoek}/4`;
                document.getElementById('money-value').textContent = `${this.money} —Ä—É–±`;
                document.getElementById('defended-value').textContent = `${this.defended}/3`;
                document.getElementById('location-value').textContent = this.location;
                document.getElementById('reputation-value').textContent = this.reputation;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ö–∏—Ä—ã
                if (this.kira_active) {
                    const secondsLeft = this.kira_duration - Math.floor((Date.now() - this.kira_time) / 1000);
                    document.getElementById('kira-status').textContent = `–∞–∫—Ç–∏–≤–Ω–∞ (${secondsLeft} —Å–µ–∫)`;
                } else {
                    document.getElementById('kira-status').textContent = "–Ω–µ –∞–∫—Ç–∏–≤–Ω–∞";
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
                if (this.start_time > 0) {
                    const elapsed = Math.floor((Date.now() - this.start_time) / 1000);
                    document.getElementById('time-value').textContent = `${elapsed} —Å–µ–∫`;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
                document.getElementById('anger-bar').style.width = `${this.anger}%`;
                document.getElementById('anger-bar').textContent = `${this.anger}%`;
                document.getElementById('health-bar').style.width = `${this.health}%`;
                document.getElementById('health-bar').textContent = `${this.health}%`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
                const inventoryContainer = document.getElementById('inventory-container');
                inventoryContainer.innerHTML = '';
                
                if (this.inventory.length === 0) {
                    inventoryContainer.innerHTML = '<div style="text-align: center; opacity: 0.7;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>';
                } else {
                    this.inventory.forEach(item => {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'inventory-item';
                        itemElement.textContent = item;
                        inventoryContainer.appendChild(itemElement);
                    });
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–Ω–æ–ø–æ–∫
                document.getElementById('action-paper').disabled = this.toilet_paper_taken;
                document.getElementById('action-break').disabled = this.broken_toilet;
                document.getElementById('action-photo').disabled = !this.broken_toilet;
                document.getElementById('action-timofey').disabled = !this.timofey_available || this.timofey_used;
                document.getElementById('action-bribe').disabled = this.bribed;
                document.getElementById('action-kira').disabled = this.kira_active || this.money < 70;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        const game = new Game();
        let gameActive = false;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateGameUI() {
            if (!gameActive) return;
            
            game.updateUI();
            
            if (game.game_over) {
                alert("–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê! –ú–∞–º–∞ —É–∑–Ω–∞–ª–∞ –æ –¥–≤–æ–π–∫–∞—Ö!");
                resetGame();
            }
            
            requestAnimationFrame(updateGameUI);
        }

        // –°–±—Ä–æ—Å –∏–≥—Ä—ã
        function resetGame() {
            game.reset();
            gameActive = false;
            document.getElementById('log').innerHTML = '';
            document.getElementById('victory-screen').style.display = 'none';
            document.getElementById('kira-effect').style.opacity = '0';
            game.updateUI();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('action-tease').addEventListener('click', () => {
            const anger_gain = Math.floor(Math.random() * 11) + 5;
            
            // –£–¥–≤–∞–∏–≤–∞–µ–º –¥–µ–Ω—å–≥–∏, –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞ –ö–∏—Ä–∞
            const money_gain = (Math.floor(Math.random() * 10) + 1) * (game.kira_active ? 2 : 1);
            
            game.increase_anger(anger_gain);
            game.money += money_gain;
            game.addToLog(`üò° –ì–µ–æ—Ä–≥–∏–π –∑–ª–∏—Ç—Å—è! +${anger_gain} –∑–ª–æ—Å—Ç–∏, +${money_gain} —Ä—É–±${game.kira_active ? ' (–±–æ–Ω—É—Å –ö–∏—Ä—ã x2!)' : ''}`);
            game.updateUI();
        });

        document.getElementById('action-light').addEventListener('click', () => {
            game.toggle_light();
            game.updateUI();
        });

        document.getElementById('action-paper').addEventListener('click', () => {
            game.steal_toilet_paper();
            game.updateUI();
        });

        document.getElementById('action-break').addEventListener('click', () => {
            game.break_toilet();
            game.updateUI();
        });

        document.getElementById('action-photo').addEventListener('click', () => {
            game.take_photo();
            game.updateUI();
        });

        document.getElementById('action-timofey').addEventListener('click', () => {
            game.use_timofey();
            game.updateUI();
        });

        document.getElementById('action-bribe').addEventListener('click', () => {
            game.bribe();
            game.updateUI();
        });

        document.getElementById('action-buy').addEventListener('click', () => {
            document.getElementById('buy-modal').style.display = 'flex';
        });

        document.getElementById('action-use').addEventListener('click', () => {
            if (game.inventory.length === 0) {
                game.addToLog("\nüéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç!");
                return;
            }
            
            const container = document.getElementById('use-items-container');
            container.innerHTML = '';
            
            game.inventory.forEach(item => {
                const btn = document.createElement('button');
                btn.className = 'use-item';
                btn.textContent = item;
                btn.style.margin = '10px 0';
                btn.dataset.item = item;
                container.appendChild(btn);
            });
            
            document.getElementById('use-modal').style.display = 'flex';
        });

        document.getElementById('action-move').addEventListener('click', () => {
            document.getElementById('move-modal').style.display = 'flex';
        });

        document.getElementById('action-kira').addEventListener('click', () => {
            game.activateKira();
            game.updateUI();
        });

        document.getElementById('action-save').addEventListener('click', () => {
            localStorage.setItem('toilet_wars_save', JSON.stringify(game));
            game.addToLog("\nüíæ –ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!");
            game.updateUI();
        });

        document.getElementById('action-menu').addEventListener('click', () => {
            resetGame();
        });

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        document.getElementById('math-submit').addEventListener('click', () => {
            const answer = document.getElementById('math-answer').value;
            game.solve_math_problem(answer);
            document.getElementById('math-modal').style.display = 'none';
            game.anger = 0;
            game.updateUI();
        });

        document.querySelectorAll('.buy-item').forEach(btn => {
            btn.addEventListener('click', () => {
                const item = btn.dataset.item;
                game.buy_item(item);
                document.getElementById('buy-modal').style.display = 'none';
                game.updateUI();
            });
        });

        document.getElementById('buy-cancel').addEventListener('click', () => {
            document.getElementById('buy-modal').style.display = 'none';
        });

        document.getElementById('use-cancel').addEventListener('click', () => {
            document.getElementById('use-modal').style.display = 'none';
        });

        document.getElementById('move-cancel').addEventListener('click', () => {
            document.getElementById('move-modal').style.display = 'none';
        });

        document.getElementById('victory-save').addEventListener('click', () => {
            localStorage.setItem('toilet_wars_save', JSON.stringify(game));
            resetGame();
        });

        document.getElementById('victory-continue').addEventListener('click', () => {
            game.victory_achieved = false;
            document.getElementById('victory-screen').style.display = 'none';
            game.addToLog("\nüîì –†–µ–∂–∏–º –ø–µ—Å–æ—á–Ω–∏—Ü—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!");
            game.updateUI();
        });

        document.querySelectorAll('.move-location').forEach(btn => {
            btn.addEventListener('click', () => {
                const location = btn.dataset.location;
                game.change_location(location);
                document.getElementById('move-modal').style.display = 'none';
                game.updateUI();
            });
        });

        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('use-item')) {
                const item = e.target.dataset.item;
                document.getElementById('use-modal').style.display = 'none';
                
                if (item === "–ë–∞–ª–ª–æ–Ω—á–∏–∫") {
                    game.use_chemical_attack();
                } else if (item === "–ö–Ω–æ–ø–∫–∞") {
                    game.use_panic_button();
                } else if (item === "–ú—ã–ª–æ") {
                    game.addToLog("\nüßº –ì–µ–æ—Ä–≥–∏–π –ø–æ—Å–∫–æ–ª—å–∑–Ω—É–ª—Å—è! -25 HP");
                    game.apply_damage(25, 25);
                    game.inventory = game.inventory.filter(i => i !== "–ú—ã–ª–æ");
                }
                game.updateUI();
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        window.addEventListener('load', () => {
            const save = localStorage.getItem('toilet_wars_save');
            if (save) {
                try {
                    const savedGame = JSON.parse(save);
                    Object.assign(game, savedGame);
                    game.addToLog("\nüîÉ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!");
                    gameActive = true;
                    game.start_time = Date.now() - (game.complaints * 10000);
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –ö–∏—Ä—ã, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ –∞–∫—Ç–∏–≤–Ω–∞
                    if (game.kira_active) {
                        const elapsed = Date.now() - game.kira_time;
                        const remaining = game.kira_duration * 1000 - elapsed;
                        if (remaining > 0) {
                            setTimeout(() => {
                                game.kira_active = false;
                                game.addToLog("‚è± –í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è –ö–∏—Ä—ã –∏—Å—Ç–µ–∫–ª–æ.", true);
                                document.getElementById('kira-effect').style.opacity = '0';
                            }, remaining);
                            document.getElementById('kira-effect').style.opacity = '1';
                        } else {
                            game.kira_active = false;
                        }
                    }
                    
                    game.updateUI();
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è", e);
                }
            }
            
            // –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–π –∏–≥—Ä—ã
            document.querySelectorAll('button').forEach(btn => {
                if (btn.textContent.includes('–ù–æ–≤–∞—è –∏–≥—Ä–∞')) {
                    btn.addEventListener('click', () => {
                        game.reset();
                        gameActive = true;
                        game.start_time = Date.now();
                        document.getElementById('log').innerHTML = '';
                        game.addToLog("üöΩ –ù–æ–≤–∞—è –∏–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –£–¥–∞—á–∏ –ø—Ä–æ—Ç–∏–≤ –ì–µ–æ—Ä–≥–∏—è!");
                        updateGameUI();
                    });
                }
            });
            
            // –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞
            document.addEventListener('keydown', (e) => {
                if (e.key === 'F12') {
                    if (!game.inventory.includes("Fresher") && game.inventory.length < game.inventory_size) {
                        game.inventory.push("Fresher");
                        game.addToLog("\nüåÄ –°–µ–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç 'Fresher' –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å!");
                        game.updateUI();
                    }
                }
            });
        });

        // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        game.updateUI();
    </script>
</body>
</html>
